SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

ALTER TABLE tb_node ADD COLUMN city varchar(64) DEFAULT NULL COMMENT '城市（城市编号）';
ALTER TABLE tb_node ADD COLUMN agency varchar(250) DEFAULT NULL COMMENT '节点机构';

-- contract warehouse - traceability
INSERT INTO `tb_contract_item` (`id`, `warehouse_id`, `contract_folder_id`, `contract_name`, `contract_source`, `description`, `description_en`, `create_time`, `modify_time`) VALUES
(31, 6, 7, 'Goods', 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjU7CnByYWdtYSBleHBlcmltZW50YWwgQUJJRW5jb2RlclYyOwoKY29udHJhY3QgR29vZHMgewogICAgc3RydWN0IFRyYWNlRGF0YSB7CiAgICAgICAgYWRkcmVzcyBhZGRyOyAgICAgLy9PcGVyYXRvciBhZGRyZXNzCiAgICAgICAgaW50MTYgc3RhdHVzOyAgICAgLy9nb29kcyBzdGF0dXMKICAgICAgICB1aW50IHRpbWVzdGFtcDsgICAvL09wZXJhdG9yIHRpbWUKICAgICAgICBzdHJpbmcgcmVtYXJrOyAgICAvL0RpZ2VzdGVkIERhdGEKICAgIH0KICAgIHVpbnQ2NCBfZ29vZHNJZDsgCiAgICBpbnQxNiBfc3RhdHVzOyAgIC8vY3VycmVudCBzdGF0dXMKICAgIFRyYWNlRGF0YVtdIF90cmFjZURhdGE7CiAgICAKICAgIGV2ZW50IG5ld1N0YXR1cyggYWRkcmVzcyBhZGRyLCBpbnQxNiBzdGF0dXMsIHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgcmVtYXJrKTsKICAgIAogICAgY29uc3RydWN0b3IodWludDY0IGdvb2RzSWQpIHB1YmxpYyB7CiAgICAgICAgX2dvb2RzSWQgPSBnb29kc0lkOwogICAgICAgIF90cmFjZURhdGEucHVzaChUcmFjZURhdGEoe2FkZHI6bXNnLnNlbmRlciwgc3RhdHVzOjAsIHRpbWVzdGFtcDpub3csIHJlbWFyazoiY3JlYXRlIn0pKTsKICAgICAgICBlbWl0IG5ld1N0YXR1cyhtc2cuc2VuZGVyLCAwLCBub3csICJjcmVhdGUiKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hhbmdlU3RhdHVzKGludDE2IGdvb2RzU3RhdHVzLCBzdHJpbmcgbWVtb3J5IHJlbWFyaykgcHVibGljIHsKICAgICAgICBfc3RhdHVzID0gZ29vZHNTdGF0dXM7CiAgICAgICAgX3RyYWNlRGF0YS5wdXNoKFRyYWNlRGF0YSh7YWRkcjptc2cuc2VuZGVyLCBzdGF0dXM6Z29vZHNTdGF0dXMsIHRpbWVzdGFtcDpub3csIHJlbWFyazpyZW1hcmt9KSk7CiAgICAgICAgZW1pdCBuZXdTdGF0dXMobXNnLnNlbmRlciwgZ29vZHNTdGF0dXMsIG5vdywgcmVtYXJrKTsKICAgIH0KICAgICAgCiAgICBmdW5jdGlvbiBnZXRTdGF0dXMoKSBwdWJsaWMgdmlldyByZXR1cm5zKGludDE2KSB7CiAgICAgICAgcmV0dXJuIF9zdGF0dXM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRyYWNlSW5mbygpIHB1YmxpYyB2aWV3IHJldHVybnMoVHJhY2VEYXRhW10gbWVtb3J5IF9kYXRhKSB7CiAgICAgICAgcmV0dXJuIF90cmFjZURhdGE7CiAgICB9Cn0=',
'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', 'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', now(), now());
INSERT INTO `tb_contract_item` (`id`, `warehouse_id`, `contract_folder_id`, `contract_name`, `contract_source`, `description`, `description_en`, `create_time`, `modify_time`) VALUES
(32, 6, 7, 'Traceability', 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjU7CgppbXBvcnQgIi4vR29vZHMuc29sIjsKCmNvbnRyYWN0IFRyYWNlYWJpbGl0eSB7CiAgICBzdHJ1Y3QgR29vZHNEYXRhIHsKICAgICAgICBHb29kcyB0cmFjZUdvb2RzOwogICAgICAgIGJvb2wgdmFsaWQ7CiAgICB9CiAgICBieXRlczMyIF9jYXRlZ29yeTsKICAgIG1hcHBpbmcodWludDY0ID0+IEdvb2RzRGF0YSkgcHJpdmF0ZSBfZ29vZHM7CiAgICBjb25zdHJ1Y3RvcihieXRlczMyICBnb29kc1RwKSBwdWJsaWMgewogICAgICAgIF9jYXRlZ29yeSA9IGdvb2RzVHA7CiAgICB9CiAgICAKICAgIGV2ZW50IG5ld0dvb2RzRXZlbnQodWludDY0IGdvb2RzSWQpOwogICAgCiAgICBmdW5jdGlvbiBjcmVhdGVHb29kcyh1aW50NjQgZ29vZHNJZCkgcHVibGljIHJldHVybnMoR29vZHMpIHsKICAgICAgICByZXF1aXJlKCFfZ29vZHNbZ29vZHNJZF0udmFsaWQsICJpZCByZWFsbHkgZXhpc3RzIik7CiAgICAgICAgCiAgICAgICAgX2dvb2RzW2dvb2RzSWRdLnZhbGlkID0gdHJ1ZTsKICAgICAgICBHb29kcyB0cmFjZUdvb2RzID0gbmV3IEdvb2RzKGdvb2RzSWQpOwogICAgICAgIGVtaXQgbmV3R29vZHNFdmVudChnb29kc0lkKTsKICAgICAgICBfZ29vZHNbZ29vZHNJZF0udHJhY2VHb29kcyA9IHRyYWNlR29vZHM7CiAgICAgICAgcmV0dXJuIHRyYWNlR29vZHM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNoYW5nZUdvb2RzU3RhdHVzKHVpbnQ2NCBnb29kc0lkLCBpbnQxNiBnb29kc1N0YXR1cywgc3RyaW5nIG1lbW9yeSByZW1hcmspIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfZ29vZHNbZ29vZHNJZF0udmFsaWQsICJub3QgZXhpc3RzIik7CiAgICAgICAgIF9nb29kc1tnb29kc0lkXS50cmFjZUdvb2RzLmNoYW5nZVN0YXR1cyhnb29kc1N0YXR1cywgcmVtYXJrKTsKICAgIH0KICAgICAgCiAgICAgZnVuY3Rpb24gZ2V0U3RhdHVzKHVpbnQ2NCBnb29kc0lkKSBwdWJsaWMgdmlldyByZXR1cm5zKGludDE2KSB7CiAgICAgICAgIHJlcXVpcmUoX2dvb2RzW2dvb2RzSWRdLnZhbGlkLCAibm90IGV4aXN0cyIpOwogICAgICAgICByZXR1cm4gX2dvb2RzW2dvb2RzSWRdLnRyYWNlR29vZHMuZ2V0U3RhdHVzKCk7CiAgICB9CgogICAgIGZ1bmN0aW9uIGdldEdvb2RzKHVpbnQ2NCBnb29kc0lkKSBwdWJsaWMgdmlldyByZXR1cm5zKEdvb2RzKSB7CiAgICAgICAgIHJlcXVpcmUoX2dvb2RzW2dvb2RzSWRdLnZhbGlkLCAibm90IGV4aXN0cyIpOwogICAgICAgICByZXR1cm4gX2dvb2RzW2dvb2RzSWRdLnRyYWNlR29vZHM7CiAgICB9Cn0K',
'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', 'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', now(), now());
INSERT INTO `tb_contract_item` (`id`, `warehouse_id`, `contract_folder_id`, `contract_name`, `contract_source`, `description`, `description_en`, `create_time`, `modify_time`) VALUES
(33, 6, 7, 'TraceabilityFactory', 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjU7CgppbXBvcnQgIi4vVHJhY2VhYmlsaXR5LnNvbCI7Cgpjb250cmFjdCBUcmFjZWFiaWxpdHlGYWN0b3J5IHsKICAgIHN0cnVjdCBHb29kc1RyYWNlIHsKICAgICAgICBUcmFjZWFiaWxpdHkgdHJhY2U7CiAgICAgICAgYm9vbCB2YWxpZDsKICAgIH0KICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBHb29kc1RyYWNlKSBwcml2YXRlIF9nb29kc0NhdGVnb3J5OwoKCWV2ZW50IG5ld1RyYWNlRXZlbnQoYnl0ZXMzMiBnb29kc0dyb3VwKTsKCQoJLy9DcmVhdGUgdHJhY2VhYmlsaXR5IGNvbW1vZGl0eSBjYXRlZ29yeQogICAgZnVuY3Rpb24gY3JlYXRlVHJhY2VhYmlsaXR5KGJ5dGVzMzIgZ29vZHNHcm91cCkgcHVibGljIHJldHVybnMoVHJhY2VhYmlsaXR5KSB7CiAgICAgICAgcmVxdWlyZSghX2dvb2RzQ2F0ZWdvcnlbZ29vZHNHcm91cF0udmFsaWQsICJUaGUgdHJhZGVtYXJrIGFscmVhZHkgZXhpc3RzIik7CiAgICAgICAgVHJhY2VhYmlsaXR5IGNhdGVnb3J5ID0gbmV3IFRyYWNlYWJpbGl0eShnb29kc0dyb3VwKTsKICAgICAgICBfZ29vZHNDYXRlZ29yeVtnb29kc0dyb3VwXS52YWxpZCA9IHRydWU7CiAgICAgICAgX2dvb2RzQ2F0ZWdvcnlbZ29vZHNHcm91cF0udHJhY2UgPSBjYXRlZ29yeTsKICAgICAgICBlbWl0IG5ld1RyYWNlRXZlbnQoZ29vZHNHcm91cCk7CiAgICAgICAgcmV0dXJuIGNhdGVnb3J5OwogICAgfQogICAgCiAgICAgZnVuY3Rpb24gZ2V0VHJhY2VhYmlsaXR5KGJ5dGVzMzIgZ29vZHNHcm91cCkgcHJpdmF0ZSB2aWV3IHJldHVybnMoVHJhY2VhYmlsaXR5KSB7CiAgICAgICAgcmVxdWlyZShfZ29vZHNDYXRlZ29yeVtnb29kc0dyb3VwXS52YWxpZCwgIlRoZSB0cmFkZW1hcmsgaGFzIG5vdCBleGlzdHMiKTsKICAgICAgICByZXR1cm4gX2dvb2RzQ2F0ZWdvcnlbZ29vZHNHcm91cF0udHJhY2U7CiAgICB9CiAgICAvL0NyZWF0ZSB0cmFjZWFiaWxpdHkgcHJvZHVjdHMgICAgCiAgICBmdW5jdGlvbiBjcmVhdGVUcmFjZUdvb2RzKGJ5dGVzMzIgZ29vZHNHcm91cCwgdWludDY0IGdvb2RzSWQpIHB1YmxpYyByZXR1cm5zKEdvb2RzKSB7CiAgICAgICAgVHJhY2VhYmlsaXR5IGNhdGVnb3J5ID0gZ2V0VHJhY2VhYmlsaXR5KGdvb2RzR3JvdXApOwogICAgICAgICByZXR1cm4gY2F0ZWdvcnkuY3JlYXRlR29vZHMoZ29vZHNJZCk7CiAgICB9CiAgICAKICAgIC8vQ2hhbmdlIHByb2R1Y3Qgc3RhdHVzCiAgICBmdW5jdGlvbiBjaGFuZ2VUcmFjZUdvb2RzKGJ5dGVzMzIgZ29vZHNHcm91cCwgdWludDY0IGdvb2RzSWQsIGludDE2IGdvb2RzU3RhdHVzLCBzdHJpbmcgbWVtb3J5IHJlbWFyaykgcHVibGljIHsKICAgICAgICAgVHJhY2VhYmlsaXR5IGNhdGVnb3J5ID0gZ2V0VHJhY2VhYmlsaXR5KGdvb2RzR3JvdXApOwogICAgICAgICBjYXRlZ29yeS5jaGFuZ2VHb29kc1N0YXR1cyhnb29kc0lkLCBnb29kc1N0YXR1cywgcmVtYXJrKTsKICAgIH0KICAgIAogICAgLy9RdWVyeSB0aGUgY3VycmVudCBzdGF0dXMgb2YgZ29vZHMKICAgICBmdW5jdGlvbiBnZXRTdGF0dXMoYnl0ZXMzMiBnb29kc0dyb3VwLCB1aW50NjQgZ29vZHNJZCkgcHVibGljIHZpZXcgcmV0dXJucyhpbnQxNikgewogICAgICAgICBUcmFjZWFiaWxpdHkgY2F0ZWdvcnkgPSBnZXRUcmFjZWFiaWxpdHkoZ29vZHNHcm91cCk7CiAgICAgICAgIHJldHVybiBjYXRlZ29yeS5nZXRTdGF0dXMoZ29vZHNJZCk7CiAgICB9CiAgICAKICAgIC8vVGhlIHdob2xlIHByb2Nlc3Mgb2YgcXVlcnlpbmcgZ29vZHMKICAgICBmdW5jdGlvbiBnZXRUcmFjZUluZm8oYnl0ZXMzMiBnb29kc0dyb3VwLCB1aW50NjQgZ29vZHNJZCkgcHVibGljIHZpZXcgcmV0dXJucyhHb29kcykgewogICAgICAgICBUcmFjZWFiaWxpdHkgY2F0ZWdvcnkgPSBnZXRUcmFjZWFiaWxpdHkoZ29vZHNHcm91cCk7CiAgICAgICAgIHJldHVybiBjYXRlZ29yeS5nZXRHb29kcyhnb29kc0lkKTsKICAgIH0KfQ==',
'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', 'IyDmuq/mupAKCiMjIOeugOS7iwoK5YyF5ZCr5Yib5bu6VHJhY2VhYmlsaXR55rqv5rqQ57G755uu44CB5Yib5bu6R29vZHPmuq/mupDllYblk4HjgIHmm7TmlrDmuq/mupAv5ZWG5ZOB54q25oCB44CB6I635Y+W5rqv5rqQL+WVhuWTgeS/oeaBr+etiQoK5ZCI57qm77yaCjEpIEdvb2RzIOa6r+a6kOWVhuWTgQoyKSBUcmFjZWFiaWxpdHkg5ZWG5ZOB5rqv5rqQ57G755uuCjMpIFRyYWNlYWJpbGl0eUZhY3Rvcnkg5rqv5rqQ5bel5Y6C57G7Cg==', now(), now());
